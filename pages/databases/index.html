<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bases de Datos | Costealo</title>

    <!-- Estilos -->
    <link rel="stylesheet" href="../../css/variables.css">
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/components.css">

    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family:Poppins:wght@600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-logo">COSTEALO</div>

        <nav class="sidebar-nav">
            <a href="../dashboard/index.html" class="sidebar-item">
                <span>游</span> Dashboard
            </a>
            <a href="#" class="sidebar-item active">
                <span>游늵</span> Base de datos
            </a>
            <a href="../workbooks/index.html" class="sidebar-item">
                <span>游늶</span> Planillas
            </a>
            <a href="#" class="sidebar-item">
                <span>游늳</span> Resumen
            </a>
        </nav>

        <div class="sidebar-footer">
            <a href="../profile/index.html" class="sidebar-item">
                <span>游녻</span> Perfil
            </a>
            <a href="#" class="sidebar-item" onclick="handleLogout(event)">
                <span>游뛁</span> Cerrar sesi칩n
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-8);">
            <h1 style="font-size: var(--font-size-3xl); font-family: var(--font-heading);">
                Bases de Datos
            </h1>
            <button class="btn btn-primary" onclick="showCreateModal()">
                + Nueva base de datos
            </button>
        </div>

        <!-- Search -->
        <div class="search-bar" style="margin-bottom: var(--space-8);">
            <span class="search-icon">游댌</span>
            <input type="text" class="search-input" placeholder="Buscar bases de datos..." id="searchInput">
        </div>

        <!-- Databases List -->
        <div id="databasesList">
            <!-- Will be loaded dynamically -->
        </div>
    </main>

    <!-- Create Modal -->
    <div class="modal-overlay" id="createModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Nueva Base de Datos</h2>
                <button class="modal-close" onclick="hideCreateModal()">칑</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--gris-medio); margin-bottom: var(--space-6);">
                    Pr칩ximamente: Crear base de datos desde archivo Excel o URL
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="hideCreateModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="../../js/config.js"></script>
    <script src="../../js/api.js"></script>
    <script>
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `<div class="toast-message">${message}</div>`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), CONFIG.UI.TOAST_DURATION);
        }

        function handleLogout(e) {
            e.preventDefault();
            if (confirm('쮼st치s seguro que deseas cerrar sesi칩n?')) {
                AuthService.logout();
            }
        }

        function showCreateModal() {
            document.getElementById('createModal').classList.add('active');
        }

        function hideCreateModal() {
            document.getElementById('createModal').classList.remove('active');
        }

        async function loadDatabases() {
            const container = document.getElementById('databasesList');
            container.innerHTML = '<div class="spinner"></div>';

            try {
                const databases = await DatabaseService.getAll();

                if (databases.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div style="font-size: 4rem; margin-bottom: var(--space-4); opacity: 0.5;">游늵</div>
                            <h3 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-2);">
                                No hay bases de datos
                            </h3>
                            <p style="color: var(--gris-medio); margin-bottom: var(--space-6);">
                                Crea tu primera base de datos para comenzar
                            </p>
                            <button class="btn btn-primary" onclick="showCreateModal()">Crear base de datos</button>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Items</th>
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${databases.map(db => `
                                        <tr>
                                            <td><strong>${db.name}</strong></td>
                                            <td>${db.itemCount || 0} items</td>
                                            <td>${new Date(db.createdAt).toLocaleDateString('es-BO')}</td>
                                            <td><span class="badge badge-active">Activa</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-ghost">Ver</button>
                                                <button class="btn btn-sm btn-ghost">Editar</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading databases:', error);
                container.innerHTML = '<p style="color: var(--rosa-profundo);">Error al cargar las bases de datos</p>';
                showToast('Error al cargar las bases de datos', 'error');
            }
        }

        // Check auth
        if (!AuthService.isAuthenticated()) {
            window.location.href = '../auth/login.html';
        } else {
            loadDatabases();
        }
    </script>
</body>

</html>